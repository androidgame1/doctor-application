//
$(document).ready(function () {
    $.ajax({
        method: "post",
        url: '../controller/client/client_findall_controller.php',
        data: {},
        success: function (res) {
            $res = res;
            if ($res == '2') {
                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
            } else {
                $res = JSON.parse(res);
                if ($res.length > 0) {
                    for (var i = 0; i < $res.length; i++) {

                        $("#apcsl_cl_add").append('<option cl_token="' + $res[i].cl_token + '">' + $res[i].cl_fullname + '</option>')
                        $("#apcsl_cl_edite").append('<option cl_token="' + $res[i].cl_token + '">' + $res[i].cl_fullname + '</option>')
                    }
                } else if ($res.length <= 0) {
                    $("#apfrm_mod_add").append('')
                    $("#apfrm_mod_edite").append('')
                } else {
                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                }
            }
        }
    })
    $.ajax({
        method: "post",
        url: '../controller/model/model_findall_controller.php',
        data: {},
        success: function (res) {
            $res = res;
            if ($res == '2') {
                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
            } else {
                $res = JSON.parse(res);
                if ($res.length > 0) {
                    for (var i = 0; i < $res.length; i++) {
                        $("#apfrm_mod_add").append('<option mod_token="' + $res[i].mod_token + '">' + $res[i].mod_title + '</option>')
                        $("#apfrm_mod_edite").append('<option mod_token="' + $res[i].mod_token + '">' + $res[i].mod_title + '</option>')
                    }
                } else if ($res.length <= 0) {
                    $("#apfrm_mod_add").append('')
                    $("#apfrm_mod_edite").append('')
                } else {
                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                }
            }
        }

    });
    !function ($) {
        "use strict";
        var CalendarApp = function () {
            this.$body = $("body")
            this.$calendar = $('#calendar'),
                    this.$event = ('#calendar-events div.calendar-events'),
                    this.$categoryForm = $('#add-new-event form'),
                    this.$extEvents = $('#calendar-events'),
                    this.$modal = $('#my-event'),
                    this.$saveCategoryBtn = $('.save-category'),
                    this.$calendarObj = null
        };
        /* on drop */
        CalendarApp.prototype.onDrop = function (eventObj, date) {
            var $this = this;
            // retrieve the dropped element's stored Event Object
            var originalEventObject = eventObj.data('eventObject');
            var $categoryClass = eventObj.attr('data-class');
            // we need to copy it, so that multiple events don't have a reference to the same object
            var copiedEventObject = $.extend({}, originalEventObject);
            // assign it the date that was reported
            copiedEventObject.start = date;
            if ($categoryClass)
                copiedEventObject['className'] = [$categoryClass];
            // render the event on the calendar
            $this.$calendar.fullCalendar('renderEvent', copiedEventObject, true);
            // is the "remove after drop" checkbox checked?
            if ($('#drop-remove').is(':checked')) {
                // if so, remove the element from the "Draggable Events" list
                eventObj.remove();
            }
        },
                /* on click on event */
                CalendarApp.prototype.onEventClick = function (calEvent, jsEvent, view) {
                    var $this = this;
                    var form = $("<form></form>");
                    form.append("<label>Change event name</label>");
                    form.append("<div class='input-group'><input class='form-control' type=text value='" + calEvent.title + "' /><span class='input-group-btn'><button type='submit' class='btn btn-success waves-effect waves-light'><i class='fa fa-check'></i> Save</button></span></div>");
                    $this.$modal.modal({
                        backdrop: 'static'
                    });
                    $this.$modal.find('.delete-event').show().end().find('.save-event').hide().end().find('.modal-body').empty().prepend(form).end().find('.delete-event').unbind('click').click(function () {
                        $this.$calendarObj.fullCalendar('removeEvents', function (ev) {
                            return (ev._id == calEvent._id);
                        });
                        $this.$modal.modal('hide');
                    });
                    $this.$modal.find('form').on('submit', function () {
                        calEvent.title = form.find("input[type=text]").val();
                        $this.$calendarObj.fullCalendar('updateEvent', calEvent);
                        $this.$modal.modal('hide');
                        return false;
                    });
                },
                /* on select */
                CalendarApp.prototype.onSelect = function (start, end, allDay) {
                    var $this = this;
                    $this.$modal.modal({
                        backdrop: 'static'
                    });
                    var form = $("<form></form>");
                    form.append("<div class='row'></div>");
                    form.find(".row")
                            .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Event Name</label><input class='form-control' placeholder='Insert Event Name' type='text' name='title'/></div></div>")
                            .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Category</label><select class='form-control' name='category'></select></div></div>")
                            .find("select[name='category']")
                            .append("<option value='bg-danger'>Danger</option>")
                            .append("<option value='bg-success'>Success</option>")
                            .append("<option value='bg-purple'>Purple</option>")
                            .append("<option value='bg-primary'>Primary</option>")
                            .append("<option value='bg-pink'>Pink</option>")
                            .append("<option value='bg-info'>Info</option>")
                            .append("<option value='bg-warning'>Warning</option></div></div>");
                    $this.$modal.find('.delete-event').hide().end().find('.save-event').show().end().find('.modal-body').empty().prepend(form).end().find('.save-event').unbind('click').click(function () {
                        form.submit();
                    });
                    $this.$modal.find('form').on('submit', function () {
                        var title = form.find("input[name='title']").val();
                        var beginning = form.find("input[name='beginning']").val();
                        var ending = form.find("input[name='ending']").val();
                        var categoryClass = form.find("select[name='category'] option:checked").val();
                        if (title !== null && title.length != 0) {
                            $this.$calendarObj.fullCalendar('renderEvent', {
                                title: title,
                                start: start,
                                end: end,
                                allDay: false,
                                className: categoryClass
                            }, true);
                            $this.$modal.modal('hide');
                        } else {
                            alert('You have to give a title to your event');
                        }
                        return false;
                    });
                    $this.$calendarObj.fullCalendar('unselect');
                },
                CalendarApp.prototype.enableDrag = function () {
                    //init events
                    $(this.$event).each(function () {
                        // create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
                        // it doesn't need to have a start or end
                        var eventObject = {
                            title: $.trim($(this).text()) // use the element's text as the event title
                        };
                        // store the Event Object in the DOM element so we can get to it later
                        $(this).data('eventObject', eventObject);
                        // make the event draggable using jQuery UI
                        $(this).draggable({
                            zIndex: 999,
                            revert: true, // will cause the event to go back to its
                            revertDuration: 0  //  original position after the drag
                        });
                    });
                }
        /* Initializing */
        CalendarApp.prototype.init = function () {
            this.enableDrag();
            /*  Initialize the calendar  */
            var date = new Date();
            var d = date.getDate();
            var m = date.getMonth();
            var y = date.getFullYear();
            var form = '';
            var today = new Date($.now());
            var $this = this;
            $this.$calendarObj = $this.$calendar.fullCalendar({
                lang: 'fr',
                slotDuration: '00:15:00', /* If we want to split day time each 15minutes */
                minTime: "08:00:00",
                maxTime: "20:00:00",
                defaultView: 'agendaWeek',
                locale: 'fr',
                defaultDate: moment(),
//                timeFormat: 'hh(:mm)' ,
                handleWindowResize: true,
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                }, buttonText: {
                    today: 'Aujourd\'hui',
                    month: 'Mois',
                    week: 'Semaine',
                    day: 'Jour',
                    list: 'Liste',
                }, allDayText: 'Jours',

                events: '../controller/appointment/appointment_findall_controller.php',

                editable: true,
                droppable: true, // this allows things to be dropped onto the calendar !!!
                eventLimit: true, // allow "more" link when too many events
                selectable: true,
                drop: function (date) {
                    $this.onDrop($(this), date);
                },
                select: function (start, end, allDay) {
                    $("#btn_add_apfrm").off('click')
                    $("#btn_add_apcsl").off('click')
                    $(".div_cover").fadeIn(200)
                    $(".section_choose_adding").fadeIn(200)
                    $("#btn_add_apfrm").click(function (e) {
                        e.preventDefault()
                        var apfrm_mod_token = $("#apfrm_mod_add").children(':selected').attr("mod_token")
                        var apfrm_city = $("#apfrm_city_add").val()
                        var apfrm_color = $("#apfrm_color_add").val()
                        var apfrm_description = $("#apfrm_description_add").val()
                        var apfrm_date_start = moment(start).format("YYYY-MM-DD HH:mm:ss")
                        var apfrm_date_end = moment(end).format("YYYY-MM-DD HH:mm:ss")
                        if (apfrm_mod_token == "" || apfrm_mod_token == undefined || apfrm_date_start == "" || apfrm_date_start == undefined || apfrm_date_end == "" || apfrm_date_end == undefined) {
                            swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                        } else if (apfrm_city == "" || apfrm_description == "" || apfrm_color == "") {
                            swal("Verify", "Tous les champs sont obligatoire !", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_create_frm_controller.php',
                                data: {ap_mod_token: apfrm_mod_token, ap_city: apfrm_city, ap_color: apfrm_color, ap_description: apfrm_description, ap_date_start: apfrm_date_start, ap_date_end: apfrm_date_end},
                                success: function (res) {
                                    $res = res;

                                    if ($res == 0) {
                                        swal("Verify", "Le rendez-vous n'a pas été créé par succès, réessayez !", "warning");
                                    } else if ($res == 1) {
                                        swal("Good", "Le rendez-vous a été créé par le succès.", "success")
                                                .then((value) => {
                                                    location.reload();
                                                });
                                    } else {
                                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                    }


                                }
                                ,
                                beforeSend: function () {
                                    $(".div_loading").fadeIn(200)
                                    $(".loading_page").fadeIn(200)
                                },
                                complete: function () {
                                    $(".div_loading").fadeOut(200)
                                    $(".loading_page").fadeOut(200)
                                }
                            });
                        }
                    })
                    $("#btn_add_apcsl").click(function (e) {
                        e.preventDefault()
                        var apcsl_cl_token = $("#apcsl_cl_add").children(':selected').attr("cl_token")
                        var apcsl_city = $("#apcsl_city_add").val()
                        var apcsl_color = $("#apcsl_color_add").val()
                        var apcsl_description = $("#apcsl_description_add").val()
                        var apcsl_date_start = moment(start).format("YYYY-MM-DD HH:mm:ss")
                        var apcsl_date_end = moment(end).format("YYYY-MM-DD HH:mm:ss")
                        if (apcsl_cl_token == "" || apcsl_cl_token == undefined || apcsl_date_start == "" || apcsl_date_start == undefined || apcsl_date_end == "" || apcsl_date_end == undefined) {
                            swal("Verify", "Error in the server , try again !!", "warning");
                        } else if (apcsl_city == "" || apcsl_color == "" || apcsl_description == "") {
                            swal("Verify", "Tous les champs sont obligatoire !", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_create_csl_controller.php',
                                data: {ap_cl_token: apcsl_cl_token, ap_city: apcsl_city, ap_color: apcsl_color, ap_description: apcsl_description, ap_date_start: apcsl_date_start, ap_date_end: apcsl_date_end},
                                success: function (res) {
                                    $res = res;

                                    if ($res == 0) {
                                        swal("Verify", "Le rendez-vous n'a pas été créé par succès, réessayez !", "warning");
                                    } else if ($res == 1) {
                                        swal("Good", "Le rendez-vous a été créé par le succès.", "success")
                                                .then((value) => {
                                                    location.reload();
                                                });
                                    } else {
                                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                    }


                                }
                                ,
                                beforeSend: function () {
                                    $(".div_loading").fadeIn(200)
                                    $(".loading_page").fadeIn(200)
                                },
                                complete: function () {
                                    $(".div_loading").fadeOut(200)
                                    $(".loading_page").fadeOut(200)
                                }
                            });
                        }
                    })
                },
                eventClick: function (event) {
                    $("#btn_edite_apfrm").off('click')
                    $("#btn_delete_apfrm").off('click')
                    $("#btn_edite_apcsl").off('click')
                    $("#btn_delete_apcsl").off('click')
                    var ap_etat = event.ap_etat
                    var ap_token = event.id
                    var ap_date_start = moment(event.start).format("YYYY-MM-DD HH:mm:ss")
                    var ap_date_end = moment(event.end).format("YYYY-MM-DD HH:mm:ss")

                    if (ap_etat == '0') {
                        $(".div_cover").fadeIn(200)
                        $(".section_edite_apfrm").fadeIn(200)
                        if (ap_token == "" || ap_token == undefined) {
                            swal("Verify", "Error in the server , try again !!", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_findbyid_controller.php',
                                data: {ap_token: ap_token},
                                success: function (res) {
                                    $res = res;

                                    if ($res == '2') {
                                        swal("Verify", "Error in the server , try again !!", "warning");
                                    } else {
                                        $res = JSON.parse(res);
                                        if ($res.length > 0) {
                                            $("#apfrm_mod_edite").val($res[0].title)
                                            $("#apfrm_city_edite").val($res[0].city)
                                            $("#apfrm_color_edite").val($res[0].color)
                                            $("#apfrm_description_edite").val($res[0].description)
                                        } else {
                                            swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                        }
                                    }
                                }
                            })

                            $("#btn_edite_apfrm").click(function (e) {
                                e.preventDefault()
                                var apfrm_mod_token = $("#apfrm_mod_edite").children(':selected').attr("mod_token")
                                var apfrm_city = $("#apfrm_city_edite").val()
                                var apfrm_color = $("#apfrm_color_edite").val()
                                var apfrm_description = $("#apfrm_description_edite").val()
                                if (ap_token == "" || ap_token == undefined || apfrm_mod_token == "" || apfrm_mod_token == undefined || ap_date_start == "" || ap_date_start == undefined || ap_date_end == "" || ap_date_end == undefined) {
                                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                } else if (apfrm_city == "" || apfrm_color == "" || apfrm_description == "") {
                                    swal("Verify", "Tous les champs sont obligatoire !", "warning");
                                } else {
                                    $.ajax({
                                        method: "post",
                                        url: '../controller/appointment/appointment_update_frm_controller.php',
                                        data: {ap_token: ap_token, ap_mod_token: apfrm_mod_token, ap_city: apfrm_city, ap_color: apfrm_color, ap_description: apfrm_description, ap_date_start: ap_date_start, ap_date_end: ap_date_end},
                                        success: function (res) {
                                            $res = res;
                                            if ($res == 0) {
                                                swal("Verify", "Le rendez-vous n'a pas été mis à jour par succès, réessayez !", "warning");
                                            } else if ($res == 1) {
                                                swal("Good", "Le rendez-vous a été mis à jour par le succès.", "success")
                                                        .then((value) => {
                                                            location.reload();
                                                        });
                                            } else {
                                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                            }


                                        }
                                        ,
                                        beforeSend: function () {
                                            $(".div_loading").fadeIn(200)
                                            $(".loading_page").fadeIn(200)
                                        },
                                        complete: function () {
                                            $(".div_loading").fadeOut(200)
                                            $(".loading_page").fadeOut(200)
                                        }
                                    });
                                }
                            })
                            $("#btn_delete_apfrm").click(function (e) {
                                e.preventDefault()
                                swal({
                                    title: "Are you sure?",
                                    text: "You wanna delete this appointment !",
                                    icon: "warning",
                                    buttons: true,
                                    dangerMode: true,
                                })
                                        .then((willDelete) => {
                                            if (willDelete) {
                                                if (ap_token == "" || ap_token == undefined) {
                                                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                                } else {
                                                    $.ajax({
                                                        method: "post",
                                                        url: '../controller/appointment/appointment_delete_controller.php',
                                                        data: {ap_token: ap_token},
                                                        success: function (res) {
                                                            $res = res;

                                                            if ($res == 0) {
                                                                swal("Verify", "Le rendez-vous n'a pas été supprimé par succès, réessayez !", "warning");
                                                            } else if ($res == 1) {
                                                                swal("Good", "Le rendez-vous a été supprimé par succès.", "success")
                                                                        .then((value) => {
                                                                            location.reload();
                                                                        });
                                                            } else {
                                                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                                            }


                                                        }
                                                        ,
                                                        beforeSend: function () {
                                                            $(".div_loading").fadeIn(200)
                                                            $(".loading_page").fadeIn(200)
                                                        },
                                                        complete: function () {
                                                            $(".div_loading").fadeOut(200)
                                                            $(".loading_page").fadeOut(200)
                                                        }
                                                    });
                                                }

                                            }
                                        });
                            })
                        }
                    } else if (ap_etat == '1') {
                        $(".div_cover").fadeIn(200)
                        $(".section_edite_apcsl").fadeIn(200)
                        if (ap_token == "" || ap_token == undefined) {
                            swal("Verify", "Error in the server , try again !!", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_findbyid_controller.php',
                                data: {ap_token: ap_token},
                                success: function (res) {
                                    $res = res;
                                    if ($res == '2') {
                                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                    } else {
                                        $res = JSON.parse(res);
                                        if ($res.length > 0) {
                                            $("#apcsl_cl_edite").val($res[0].title)
                                            $("#apcsl_city_edite").val($res[0].city)
                                            $("#apcsl_color_edite").val($res[0].color)
                                            $("#apcsl_description_edite").val($res[0].description)
                                        } else {
                                            swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                        }
                                    }
                                }
                            })
                            $("#btn_edite_apcsl").click(function (e) {
                                e.preventDefault()
                                var apcsl_cl_token = $("#apcsl_cl_edite").children(':selected').attr("cl_token")
                                var apcsl_city = $("#apcsl_city_edite").val()
                                var apcsl_color = $("#apcsl_color_edite").val()
                                var apcsl_description = $("#apcsl_description_edite").val()
                                if (ap_token == "" || ap_token == undefined || apcsl_cl_token == "" || apcsl_cl_token == undefined || ap_date_start == "" || ap_date_start == undefined || ap_date_end == "" || ap_date_end == undefined) {
                                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                } else if (apcsl_city == "" || apcsl_color == "" || apcsl_description == "") {
                                    swal("Verify", "Tous les champs sont obligatoire !", "warning");
                                } else {
                                    $.ajax({
                                        method: "post",
                                        url: '../controller/appointment/appointment_update_csl_controller.php',
                                        data: {ap_token: ap_token, ap_cl_token: apcsl_cl_token, ap_city: apcsl_city, ap_color: apcsl_color, ap_description: apcsl_description, ap_date_start: ap_date_start, ap_date_end: ap_date_end},
                                        success: function (res) {
                                            $res = res;
                                            if ($res == 0) {
                                                swal("Verify", "Le rendez-vous n'a pas été mis à jour par succès, réessayez !", "warning");
                                            } else if ($res == 1) {
                                                swal("Good", "Le rendez-vous a été mis à jour par le succès.", "success")
                                                        .then((value) => {
                                                            location.reload();
                                                        });
                                            } else {
                                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                            }


                                        }
                                        ,
                                        beforeSend: function () {
                                            $(".div_loading").fadeIn(200)
                                            $(".loading_page").fadeIn(200)
                                        },
                                        complete: function () {
                                            $(".div_loading").fadeOut(200)
                                            $(".loading_page").fadeOut(200)
                                        }
                                    });
                                }
                            })
                            $("#btn_delete_apcsl").click(function (e) {
                                e.preventDefault()
                                swal({
                                    title: "Are you sure?",
                                    text: "You wanna delete this appointment !",
                                    icon: "warning",
                                    buttons: true,
                                    dangerMode: true,
                                })
                                        .then((willDelete) => {
                                            if (willDelete) {
                                                if (ap_token == "" || ap_token == undefined) {
                                                    swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                                } else {
                                                    $.ajax({
                                                        method: "post",
                                                        url: '../controller/appointment/appointment_delete_controller.php',
                                                        data: {ap_token: ap_token},
                                                        success: function (res) {
                                                            $res = res;

                                                            if ($res == 0) {
                                                                swal("Verify", "Le rendez-vous n'a pas été supprimé par succès, réessayez !", "warning");
                                                            } else if ($res == 1) {
                                                                swal("Good", "Le rendez-vous a été supprimé par succès.", "success")
                                                                        .then((value) => {
                                                                            location.reload();
                                                                        });
                                                            } else {
                                                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                                            }


                                                        }
                                                        ,
                                                        beforeSend: function () {
                                                            $(".div_loading").fadeIn(200)
                                                            $(".loading_page").fadeIn(200)
                                                        },
                                                        complete: function () {
                                                            $(".div_loading").fadeOut(200)
                                                            $(".loading_page").fadeOut(200)
                                                        }
                                                    });
                                                }

                                            }
                                        });
                            })
                        }
                    } else {
                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                    }


                }, eventDrop: function (event)
                {
                    var apfrm_date_start = moment(event.start).format('YYYY-MM-DD HH:mm:ss');
                    var apfrm_date_end = moment(event.end).format('YYYY-MM-DD HH:mm:ss');
                    var apfrm_token = event.id;
                    $.ajax({
                        method: "post",
                        url: '../controller/appointment/appointment_update_hour_controller.php',
                        data: {ap_token: apfrm_token, ap_date_start: apfrm_date_start, ap_date_end: apfrm_date_end},
                        success: function (res) {
                            $res = res
                            if ($res == 0) {
                                swal("Verify", "Le rendez-vous n'a pas été mis à jour par succès, réessayez !", "warning");
                            } else if ($res == 1) {
                                console.log("good")
                            } else {
                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                            }
                        }
                    })
                },
                eventResize: function (event)
                {
                    var apfrm_date_start = moment(event.start).format('YYYY-MM-DD HH:mm:ss');
                    var apfrm_date_end = moment(event.end).format('YYYY-MM-DD HH:mm:ss');
                    var apfrm_token = event.id;
                    $.ajax({
                        method: "post",
                        url: '../controller/appointment/appointment_update_hour_controller.php',
                        data: {ap_token: apfrm_token, ap_date_start: apfrm_date_start, ap_date_end: apfrm_date_end},
                        success: function (res) {
                            $res = res
                            if ($res == 0) {
                                swal("Verify", "Le rendez-vous n'a pas été mis à jour par succès, réessayez !", "warning");
                            } else if ($res == 1) {
                                console.log("good")
                            } else {
                                swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                            }
                        }
                    })
                },
                eventMouseover: function (event)
                {
                    $this = $(this);
                    var ap_token = event.id
                    var ap_etat = event.ap_etat
                    if (ap_etat == '0') {
                        if (ap_token == "" || ap_token == undefined) {
                            swal("Verify", "Error in the server , try again !!", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_findbyid_controller.php',
                                data: {ap_token: ap_token},
                                success: function (res) {
                                    $res = res;
                                    console.log(res)
                                    if ($res == '2') {
                                        swal("Verify", "Error in the server , try again !!", "warning");
                                    } else {
                                        $res = JSON.parse(res);
                                        if ($res.length > 0) {
                                            var tooltip = '<div class="tooltiptopicevent" style="width:auto;height:auto;background:#464646;position:absolute;z-index:10001;padding:10px 10px 10px 10px ;border-radius:5px; color:white; line-height: 200%;width200px"><span class="span_prop">Nom : </span>' + $res[0].title + '</br>' + '<span class="span_prop">Ville : ' + $res[0].city + '</br>' + '<span class="span_prop">Note : </span>' + $res[0].description + '</div>';
                                            $("body").append(tooltip);
                                            $this.mouseover(function (e) {
                                                $this.css('z-index', 10000);
                                                $('.tooltiptopicevent').fadeIn('500');
                                                $('.tooltiptopicevent').fadeTo('10', 1.9);
                                            }).mousemove(function (e) {
                                                $('.tooltiptopicevent').css('top', e.pageY + 10);
                                                $('.tooltiptopicevent').css('left', e.pageX + 20);
                                            });
                                        } else {
                                            swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                        }
                                    }
                                }
                            })
                        }
                    } else if (ap_etat == '1') {
                        if (ap_token == "" || ap_token == undefined) {
                            swal("Verify", "Error in the server , try again !!", "warning");
                        } else {
                            $.ajax({
                                method: "post",
                                url: '../controller/appointment/appointment_findbyid_controller.php',
                                data: {ap_token: ap_token},
                                success: function (res) {
                                    $res = res;
                                    console.log(res)
                                    if ($res == '2') {
                                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                    } else {

                                        $res = JSON.parse(res);
                                        if ($res.length > 0) {
                                            var tooltip = '<div class="tooltiptopicevent" style="width:auto;height:auto;background:#464646;position:absolute;z-index:10001;padding:10px 10px 10px 10px ;border-radius:5px; color:white; line-height: 200%;width200px"><span class="span_prop">Nom</span> ' + ': ' + $res[0].title + '</br>' + '<span class="span_prop">Ville</span> ' + ': ' + $res[0].city + '</br>' + '<span class="span_prop">Note</span> : ' + $res[0].description + '</div>';
                                            $("body").append(tooltip);
                                            $this.mouseover(function (e) {
                                                $this.css('z-index', 10000);
                                                $('.tooltiptopicevent').fadeIn('500');
                                                $('.tooltiptopicevent').fadeTo('10', 1.9);
                                            }).mousemove(function (e) {
                                                $('.tooltiptopicevent').css('top', e.pageY + 10);
                                                $('.tooltiptopicevent').css('left', e.pageX + 20);
                                            });
                                        } else {
                                            swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                                        }
                                    }
                                }
                            })

                        }
                    } else {
                        swal("Verify", "Erreur sur le serveur, réessayez !", "warning");
                    }
                },
                eventMouseout: function (event) {
                    $(this).css('z-index', 8);
                    $('.tooltiptopicevent').remove();

                },
            });
            //on new event
            this.$saveCategoryBtn.on('click', function () {
                var categoryName = $this.$categoryForm.find("input[name='category-name']").val();
                var categoryColor = $this.$categoryForm.find("select[name='category-color']").val();
                if (categoryName !== null && categoryName.length != 0) {
                    $this.$extEvents.append('<div class="calendar-events" data-class="bg-' + categoryColor + '" style="position: relative;"><i class="fa fa-circle text-' + categoryColor + '"></i>' + categoryName + '</div>')
                    $this.enableDrag();
                }

            });
        },
                //init CalendarApp
                $.CalendarApp = new CalendarApp, $.CalendarApp.Constructor = CalendarApp

    }(window.jQuery),
//initializing CalendarApp
            function ($) {
                "use strict";
                $.CalendarApp.init()
            }(window.jQuery);
})